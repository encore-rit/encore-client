<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<title>Photo Paint</title>
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
	<script src="../colorSlider/colorSlider.js"></script>
	<script src="js/filter.js"></script>
	<link href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css' rel='stylesheet' type='text/css'>
	<link href='../colorSlider/colorSlider.css' rel='stylesheet' type='text/css'>
	<link href='css/editor0.css' rel='stylesheet' type='text/css'>
	<script src="js/jquery.ui.touch-punch.min.js"></script>
	<script src="js/painting.js"></script>
	<script src="js/undoRedo.js"></script>
	<script>
	$('.ui-widget-content').draggable();
	</script>
</head>
<body>
	<canvas id="mainCanvas" width="700" height="500">
	Get a real browser!
	</canvas>
	<canvas id="tmpCanvas" width="700" height="500">
	Get a real browser!
	</canvas>

	<canvas id="pictureCanvas">
		Get a real browser!
	</canvas>

	<img id="img" src="images/ladyGaga.jpg">

	<div id="controls">
		<ul>
			<p id="strokeText">Stroke</p>

			<li>
				<label>Line Width:
					<select id="lineWidthChooser">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3" selected>3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
					</select>
				</label>
			</li>

			<li><div id="coloredSlider"></div></li>
		</ul>

		<button type="button" id="slideMenu"><img src="images/downArrow.png"></button>
		<button type="button" id="textMenu"><img src="images/text.png"></button>
		<input type="inputText" id="input" />

  </div>
	<div id ="undoAndRedo">
		<button type="button" id="undoButton"><img src="images/Undo_Thick.png" alt="UNDO"></button>
		<button type="button" id="redoButton"><img src="images/Redo_Thick.png" alt="REDO"></button>
	</div>
	<span><input id="done" id="exportButton" type="button" value="DONE"/></span>

		<script>
		"use strict";

		// Enable fastclick library
    if ('addEventListener' in document) {
        document.addEventListener('DOMContentLoaded', function() {
            FastClick.attach(document.body);
        }, false);
    }

		window.onload = init;
		// GLOBALS
		var canvas,ctx,dragging=false,lineWidth,strokeStyle;
		var tmpCanvas, tmpCtx;
		var picCanvas, picCtx;
		var img;

		var width,height;

		var slideMenuBoolean = true;
		var textMenuBoolean = false;

		// Pencil Points
		var ppts = [];

		//making array for undo button. Picture the canvas everytime when the touch is release.
		var canvasPushArray = new Array();
		var canvasStep = -1;
		// CONSTANTS
		var DEFAULT_LINE_WIDTH = 3;
		var DEFAULT_STROKE_STYLE = "red";

		// FUNCTIONS
		function init(){
			// initialize some globals
			canvas = document.querySelector('#mainCanvas');
			ctx = canvas.getContext('2d');
			tmpCanvas = document.querySelector('#tmpCanvas');
			tmpCtx = tmpCanvas.getContext('2d');
			picCanvas = document.querySelector('#pictureCanvas');
			picCtx = picCanvas.getContext('2d');
			img = document.querySelector('#img');
			lineWidth = DEFAULT_LINE_WIDTH;
			strokeStyle = DEFAULT_STROKE_STYLE;

			tmpCtx.lineWidth = lineWidth;
			tmpCtx.lineJoin = 'round';
			tmpCtx.lineCap = 'round';
			tmpCtx.strokeStyle = strokeStyle;

			width = canvas.width;
			height = canvas.height;



			resizeCanvas();
			// Hook up event listeners
			canvas.addEventListener('touchstart', doTouchdown);
			canvas.addEventListener('touchmove', doTouchmove);
			canvas.addEventListener('touchend', doTouchup);
			canvas.addEventListener('touchcancel', doTouchout);
	    document.querySelector('#lineWidthChooser').onchange = doLineWidthChange;
			document.querySelector('#exportButton').onclick = doExport;
			document.querySelector('#clearButton').onclick = doClear;
			document.querySelector('#undoButton').onclick = canvasUndo;
			document.querySelector('#redoButton').onclick = canvasRedo;

			$("#slideMenu").click(function(){
				if(slideMenuBoolean == false){
					$("ul").slideDown();
					slideMenuBoolean = true;
				}
				else{
					$("ul").slideUp();
					slideMenuBoolean = false
				}
			});

			$("#textMenu").click(function(){
				if(textMenuBoolean == false){
					$("#inputText").slideDown();
					textMenuBoolean = true;
				}
				else{
					$("inputText").slideUp();
					textMenuBoolean = false
				}
			});


			window.onresize = resizeCanvas;
			addPicture();
			//push a blank canvas
			canvasPush();
		}

		function fragmentText(text, maxWidth) {
		    var words = text.split(' '),
		        lines = [],
		        line = "";
		    if (ctx.measureText(text).width < maxWidth) {
		        return [text];
		    }
		    while (words.length > 0) {
		        while (ctx.measureText(words[0]).width >= maxWidth) {
		            var tmp = words[0];
		            words[0] = tmp.slice(0, -1);
		            if (words.length > 1) {
		                words[1] = tmp.slice(-1) + words[1];
		            } else {
		                words.push(tmp.slice(-1));
		            }
		        }
		        if (ctx.measureText(line + words[0]).width < maxWidth) {
		            line += words.shift() + " ";
		        } else {
		            lines.push(line);
		            line = "";
		        }
		        if (words.length === 0) {
		            lines.push(line);
		        }
		    }
		    return lines;
		}

		function draw() {
				var fontSize = "24px";
				var fontFamily = "edo SZ";
				var fontColour = "blue";
		    ctx.save();
		    ctx.clearRect(0, 0, width, height);
		    ctx.font = "bold " + fontSize + " " + fontFamily;
		    ctx.textAlign = "center";
		    ctx.fillStyle = fontColour;
		    var lines = fragmentText(input.value, width - parseInt(fontSize,0));
		    lines.forEach(function(line, i) {
		        ctx.fillText(line, width / 2, (i + 1) * parseInt(fontSize,0));
		    });
		    ctx.restore();
		}

		input.onkeyup = function(e) { // keyup because we need to know what the entered text is.
    draw();
		};

		</script>

<script src="./libs/inobounce.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
</body>
</html>
