<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Global CSS for the page and tiles -->
  <link rel="stylesheet" href="./css/main.css">
</head>

<body>

  <div id="container">

    <header>
      <h1>Artist Selection</h1>
      <p></p>
    </header>

    <div id="main" role="main">

      <div id="loader">
        <div id="loaderCircle"></div>
      </div>

      <input type="text" id="stageName" placeholder="Stage Name Here">
      <input type="button" id="stageNameBtn" value="Rock!">

      <select id="artistSelect">
        <option>--Choose Artist--</option>
      </select>

      <div id="chosen"></div>

    </div>

  </div>

  <!-- include jQuery -->
  <script src="./libs/jquery.min.js"></script>

  <!-- Once the page is loaded, initalize the plug-in. -->
  <script type="text/javascript">
    (function ($) {
      var handler = null,
          isLoading = false,
          fullData,
          userData={};

      /**
       * Loads data from the API.
       */
      function loadData() {
        isLoading = true;
        $('#loaderCircle').show();

        $.ajax({
          // url: "data.json",
          url: "http://localhost:1339/artists",
          method: 'GET',
          dataType: 'json',
          success: function(result){
            onLoadData(result);
            fullData = result;
          },
          error: function(err) {
            console.log('err', err)
          }
        });
      };

      /**
       * Receives data from the API, creates HTML for images and updates the layout
       */
      function onLoadData(data) {
        isLoading = false;
        $('#loaderCircle').hide();

        $.each(data, function(i, value) {
          $('#artistSelect').append($('<option>').text(value.name).attr('value', value.name));
        });
      };

      $('#stageNameBtn').on('click', function(){
        userData.name = $('#stageName').val();
      });

      $('select').on('change', function() {
        isLoading = true;
        $('#loaderCircle').show();

        $("#chosen").empty();

        var name = this.value;

        $.each(fullData, function(i, value) {
          if(value.name == name){
            $('#chosen').append($('<p>').text(value.dob +"-"+ value.dod));
            $('#chosen').append($('<p>').text(value.bio));
            $('#chosen').append($('<img>').attr("src", value.sigUrl));
            $('#chosen').append($('<img>').attr("src", value.photoUrl));

            $.each(value.artifacts, function(i, v) {
              $('#chosen').append($('<div>').attr("id", "artifacts"));
              $('#artifacts').append($('<h4>').text("Artifacts:"));
              $('#artifacts').append($('<p>').text("Name: " + v.name));
              $('#artifacts').append($('<p>').text("Description: " + v.description));
              $('#artifacts').append($('<p>').text("Location: " + v.location));
            });
            return;
          }
        });

        $('#chosen').append($('<input>').attr("type","button").attr("value","Choose Artist").attr("id","chooseBtn"));

        $('#chooseBtn').on('click', function(){
            userData.artistId = name;
  
            $.ajax({
              url: "http://localhost:1339/users",
              method: 'POST',
              dataType: 'json',
              data: userData,
              success: showResult,
              error: function(err) {
                console.log('err', err)
              }
            });
        });
      });

      function showResult(){

      }

      // Load first data from the API.
      loadData();
    })(jQuery);
  </script>

</body>
</html>
